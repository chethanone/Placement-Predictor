{% extends 'predictor/base.html' %}
{% load static %}

{% block title %}Officer Dashboard - AI Placement Predictor{% endblock %}

{% block extra_css %}
<style>
 .dashboard-metrics {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
 gap: 1.5rem;
 margin-bottom: 2rem;
 }
 .metric-card {
 background: white;
 border-radius: 12px;
 padding: 1.5rem;
 box-shadow: 0 2px 4px rgba(0,0,0,0.04);
 transition: transform 0.2s;
 }
 .metric-card:hover {
 transform: translateY(-2px);
 }
 .metric-title {
 color: #6B7280;
 font-size: 0.875rem;
 font-weight: 600;
 margin-bottom: 0.5rem;
 }
 .metric-value {
 font-size: 1.875rem;
 font-weight: 700;
 color: #111827;
 }
 .metric-trend {
 display: flex;
 align-items: center;
 gap: 0.5rem;
 margin-top: 0.5rem;
 font-size: 0.875rem;
 }
 .trend-up { color: #059669; }
 .trend-down { color: #DC2626; }
 .chart-container {
 background: white;
 border-radius: 12px;
 padding: 1.5rem;
 margin-bottom: 1.5rem;
 box-shadow: 0 2px 4px rgba(0,0,0,0.04);
 }
 .chart-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 1rem;
 }
 .chart-title {
 font-size: 1.125rem;
 font-weight: 600;
 color: #111827;
 }
 .feature-importance-grid {
 display: grid;
 gap: 1rem;
 margin-top: 1rem;
 }
 .feature-item {
 background: #F9FAFB;
 padding: 1rem;
 border-radius: 8px;
 }
 .feature-info {
 display: flex;
 justify-content: space-between;
 margin-bottom: 0.5rem;
 }
 .feature-name {
 font-weight: 500;
 color: #374151;
 }
 .feature-value {
 font-weight: 600;
 color: #2563EB;
 }
 .feature-bar-container {
 width: 100%;
 height: 6px;
 background: #E5E7EB;
 border-radius: 999px;
 overflow: hidden;
 }
 .feature-bar {
 height: 100%;
 background: #2563EB;
 border-radius: 999px;
 transition: width 0.5s ease;
 }
 .table-responsive {
 overflow-x: auto;
 margin: 0 -1.5rem;
 padding: 0 1.5rem;
 }
 .predictions-table {
 width: 100%;
 border-collapse: collapse;
 }
 .predictions-table th {
 background: #F9FAFB;
 padding: 0.75rem 1rem;
 text-align: left;
 font-weight: 600;
 color: #374151;
 border-bottom: 2px solid #E5E7EB;
 }
 .predictions-table td {
 padding: 0.75rem 1rem;
 border-bottom: 1px solid #E5E7EB;
 color: #4B5563;
 }
 .prediction-badge {
 display: inline-block;
 padding: 0.25rem 0.75rem;
 border-radius: 999px;
 font-size: 0.875rem;
 font-weight: 500;
 }
 .prediction-badge.success {
 background: #ECFDF5;
 color: #059669;
 }
 .prediction-badge.warning {
 background: #FEF3C7;
 color: #D97706;
 }
 .hero-section {
 background: linear-gradient(135deg, #2563EB 0%, #1E40AF 100%);
 padding: 3rem 0;
 margin-bottom: 2rem;
 color: white;
 }
 .hero-title {
 font-size: 2.25rem;
 font-weight: 700;
 margin-bottom: 0.5rem;
 }
 .hero-subtitle {
 font-size: 1.125rem;
 opacity: 0.9;
 }
</style>
{% endblock %}

{% block content %}
<div class="hero-section dashboard-hero">
 <div class="container">
 <h1 class="hero-title"><i class="fas fa-chart-line"></i> Officer Dashboard</h1>
 <p class="hero-subtitle">Performance Analytics & Insights</p>
 </div>
</div>

<div class="container">
 <div class="dashboard-layout">
 <!-- Department Performance Chart -->
 <div class="chart-container">
 <div class="chart-header">
 <h2 class="chart-title">Department-wise Performance</h2>
 </div>
 <canvas id="deptChart" width="100%" height="300" aria-label="Department performance chart"></canvas>
 </div>

 <!-- Key Metrics -->
 <div class="dashboard-metrics">
 <div class="metric-card">
 <div class="metric-title">Total Students</div>
 <div class="metric-value">{{ total_students }}</div>
 <div class="metric-trend">
 <i class="fas fa-chart-line"></i>
 <span>Active Students</span>
 </div>
 </div>
 
 <div class="metric-card">
 <div class="metric-title">Placement Rate</div>
 <div class="metric-value">{{ placement_rate|floatformat:1 }}%</div>
 <div class="metric-trend {% if placement_rate > 16.59 %}trend-up{% else %}trend-down{% endif %}">
 <i class="fas fa-{% if placement_rate > 16.59 %}arrow-up{% else %}arrow-down{% endif %}"></i>
 <span>vs. 16.59% benchmark</span>
 </div>
 </div>

 <div class="metric-card">
 <div class="metric-title">Placed Students</div>
 <div class="metric-value">{{ placed_count }}</div>
 <div class="metric-trend">
 <i class="fas fa-user-graduate"></i>
 <span>Successfully Placed</span>
 </div>
 </div>

 <div class="metric-card">
 <div class="metric-title">Model Accuracy</div>
 <div class="metric-value">99.8%</div>
 <div class="metric-trend trend-up">
 <i class="fas fa-check-circle"></i>
 <span>High Confidence</span>
 </div>
 </div>
 </div>

 <!-- Feature Importance -->
 <div class="chart-container">
 <div class="chart-header">
 <h2 class="chart-title">Key Placement Factors</h2>
 </div>
 <div class="feature-importance-grid">
 {% for feature, importance in feature_importance %}
 <div class="feature-item">
 <div class="feature-info">
 <span class="feature-name">{{ feature }}</span>
 <span class="feature-value">{{ importance|floatformat:1 }}%</span>
 </div>
 <div class="feature-bar-container">
 <div class="feature-bar" style="width: {{ importance|floatformat:1 }}%"></div>
 </div>
 </div>
 {% endfor %}
 </div>
 </div>

 <!-- Recent Predictions Table -->
 <div class="chart-container">
 <div class="chart-header">
 <h2 class="chart-title">Recent Predictions</h2>
 </div>
 <div class="table-responsive">
 <table class="predictions-table">
 <thead>
 <tr>
 <th>Student ID</th>
 <th>CGPA</th>
 <th>IQ Score</th>
 <th>Projects</th>
 <th>Prediction</th>
 <th>Confidence</th>
 </tr>
 </thead>
 <tbody>
 {% for prediction in recent_predictions %}
 <tr>
 <td>{{ prediction.student_id }}</td>
 <td>{{ prediction.cgpa|floatformat:2 }}</td>
 <td>{{ prediction.iq_score }}</td>
 <td>{{ prediction.projects_completed }}</td>
 <td>
 <span class="prediction-badge {% if prediction.placement_predicted %}success{% else %}warning{% endif %}">
 {{ prediction.placement_predicted|yesno:"Placed,Not Placed" }}
 </span>
 </td>
 <td>{{ prediction.confidence_score|floatformat:1 }}%</td>
 </tr>
 {% endfor %}
 </tbody>
 </table>
 </div>
 </div>
 </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
 // Department Performance Chart
 const deptChartEl = document.getElementById('deptChart');
 if (deptChartEl) {
 const ctx = deptChartEl.getContext('2d');
 const chartData = {
 labels: JSON.parse('{{ dept_labels|escapejs }}'),
 datasets: [{
 label: 'Placement Rate (%)',
 data: JSON.parse('{{ dept_values|escapejs }}'),
 backgroundColor: 'rgba(59, 130, 246, 0.5)',
 borderColor: 'rgb(59, 130, 246)',
 borderWidth: 1
 }]
 };
 const chartOptions = {
 responsive: true,
 maintainAspectRatio: false,
 plugins: {
 legend: {
 display: false
 },
 tooltip: {
 backgroundColor: 'rgba(0, 0, 0, 0.8)',
 padding: 12,
 bodyFont: {
 size: 14
 },
 callbacks: {
 label: function(context) {
 return `Placement Rate: ${context.parsed.y.toFixed(1)}%`;
 }
 }
 }
 },
 scales: {
 y: {
 beginAtZero: true,
 grid: {
 display: true,
 color: 'rgba(0, 0, 0, 0.05)'
 },
 ticks: {
 callback: function(value) {
 return value + '%';
 }
 }
 },
 x: {
 grid: {
 display: false
 }
 }
 }
 };
 new Chart(ctx, {
 type: 'bar',
 data: chartData,
 options: chartOptions
 });
});
 <canvas id="deptChart" width="300" height="200" aria-label="Department employability bar chart"></canvas>
 </div>
 </aside>

 <!-- Main dashboard column -->
 <div class="dashboard-container">

 <!-- Feature Importance -->
 <div class="feature-importance-section">
 <h2 class="section-title">
 <i class="fas fa-star"></i>
 Top Factors Affecting Placement
 </h2>
 <div class="feature-importance-card">
 <div class="features-list">
 {% for feature, importance in feature_importance %}
 <div class="feature-item">
 <div class="feature-info">
 <span class="feature-name">{{ forloop.counter }}. {{ feature }}</span>
 <span class="feature-value">{{ importance|floatformat:4 }}</span>
 </div>
 <div class="feature-bar">
 <div class="feature-fill" data-importance="{{ importance }}"></div>
 </div>
 </div>
 {% endfor %}
 </div>
 </div>
 </div>

 <!-- Model Performance -->
 <div class="model-performance-section">
 <h2 class="section-title">
 <i class="fas fa-robot"></i>
 Model Performance Metrics
 </h2>
 <div class="performance-grid">
 <div class="performance-card">
 <div class="performance-icon"><i class="fas fa-check-double"></i></div>
 <div class="performance-content">
 <div class="performance-label">Accuracy</div>
 <div class="performance-value">{{ model_accuracy|floatformat:2 }}%</div>
 <div class="performance-bar">
 <div class="performance-fill" id="accuracyFill"></div>
 </div>
 </div>
 </div>
 <div class="performance-card">
 <div class="performance-icon"><i class="fas fa-bullseye"></i></div>
 <div class="performance-content">
 <div class="performance-label">Precision</div>
 <div class="performance-value">{{ model_precision|floatformat:2 }}%</div>
 <div class="performance-bar">
 <div class="performance-fill" id="precisionFill"></div>
 </div>
 </div>
 </div>
 <div class="performance-card">
 <div class="performance-icon"><i class="fas fa-redo"></i></div>
 <div class="performance-content">
 <div class="performance-label">Recall</div>
 <div class="performance-value">{{ model_recall|floatformat:2 }}%</div>
 <div class="performance-bar">
 <div class="performance-fill" id="recallFill"></div>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Recent Predictions -->
 {% if recent_predictions %}
 <div class="recent-predictions-section">
 <h2 class="section-title">
 <i class="fas fa-clock"></i>
 Recent Predictions
 </h2>
 <div class="table-responsive">
 <table class="data-table">
 <thead>
 <tr>
 <th>Name</th>
 <th>CGPA</th>
 <th>Projects</th>
 <th>Communication</th>
 <th>Certificates</th>
 <th>Prediction</th>
 <th>Probability</th>
 <th>Date</th>
 </tr>
 </thead>
 <tbody>
 {% for pred in recent_predictions %}
 <tr>
 <td><strong>{{ pred.name }}</strong></td>
 <td>{{ pred.cgpa|floatformat:2 }}</td>
 <td>{{ pred.projects_completed }}</td>
 <td>{{ pred.communication_skills }}/10</td>
 <td>
 {% if pred.has_certificates %}
 <span class="badge badge-success"><i class="fas fa-check"></i> Yes</span>
 {% else %}
 <span class="badge badge-danger"><i class="fas fa-times"></i> No</span>
 {% endif %}
 </td>
 <td>
 {% if pred.placement_prediction == 'Yes' %}
 <span class="badge badge-success">Placed</span>
 {% else %}
 <span class="badge badge-warning">Not Placed</span>
 {% endif %}
 </td>
 <td><strong>{{ pred.placement_probability|floatformat:1 }}%</strong></td>
 <td>{{ pred.created_at|date:"M d, Y" }}</td>
 </tr>
 {% endfor %}
 </tbody>
 </table>
 </div>
 </div>
 {% endif %}

 <!-- Key Insights -->
 <div class="insights-section">
 <h2 class="section-title">
 <i class="fas fa-lightbulb"></i>
 Key Insights
 </h2>
 <div class="insights-grid">
 <div class="insight-card">
 <div class="insight-icon"><i class="fas fa-comments"></i></div>
 <h3>Communication Skills</h3>
 <p>The most important factor affecting placement. Students with communication skills above 7/10 have 60% higher placement rates.</p>
 </div>
 <div class="insight-card">
 <div class="insight-icon"><i class="fas fa-project-diagram"></i></div>
 <h3>Projects Matter</h3>
 <p>Students with 3+ projects have significantly better chances. Quality projects demonstrate practical skills and initiative.</p>
 </div>
 <div class="insight-card">
 <div class="insight-icon"><i class="fas fa-brain"></i></div>
 <h3>IQ & Problem Solving</h3>
 <p>Higher IQ scores correlate with better placement outcomes. Regular practice on coding platforms helps improve this metric.</p>
 </div>
 <div class="insight-card">
 <div class="insight-icon"><i class="fas fa-graduation-cap"></i></div>
 <h3>Academic Consistency</h3>
 <p>Maintaining consistent CGPA above 7.5 shows dedication and reliability, traits valued by recruiters.</p>
 </div>
 </div>
 </div>

 <!-- Action Button -->
 <div class="form-actions">
 <a href="{% url 'home' %}" class="btn btn-primary btn-large">
 <i class="fas fa-arrow-left"></i>
 Back to Student Portal
 </a>
 </div>
</div>
{% endblock %}
