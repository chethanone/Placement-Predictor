{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Training Sessions - Student Portal</title>
 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
 <style>
 :root {
 --sage-green: #8FB9A8;
 --cream: #FEFAD4;
 --peach: #FCB9AA;
 --rose: #F1828D;
 --mauve: #765D69;
 }
 
 * {
 margin: 0;
 padding: 0;
 box-sizing: border-box;
 }

 body {
 font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
 background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
 min-height: 100vh;
 color: #333;
 padding: 20px;
 }

 .container {
 max-width: 1200px;
 margin: 0 auto;
 animation: fadeIn 0.6s ease-out;
 }
 
 @keyframes fadeIn {
 from {
 opacity: 0;
 transform: translateY(20px);
 }
 to {
 opacity: 1;
 transform: translateY(0);
 }
 }
 
 .back-link {
 display: inline-flex;
 align-items: center;
 gap: 8px;
 margin-bottom: 24px;
 color: var(--mauve);
 text-decoration: none;
 font-size: 15px;
 font-weight: 600;
 padding: 10px 20px;
 border-radius: 10px;
 background: white;
 box-shadow: 0 2px 8px rgba(0,0,0,0.1);
 transition: all 0.3s ease;
 }

 .back-link:hover {
 background: var(--mauve);
 color: white;
 transform: translateX(-4px);
 box-shadow: 0 4px 12px rgba(118, 93, 105, 0.3);
 }

 .header {
 background: linear-gradient(135deg, var(--sage-green) 0%, #6a9d88 100%);
 padding: 40px;
 border-radius: 24px;
 margin-bottom: 32px;
 box-shadow: 0 15px 40px rgba(143, 185, 168, 0.3);
 position: relative;
 overflow: hidden;
 }
 
 .header::before {
 content: '';
 position: absolute;
 width: 300px;
 height: 300px;
 background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
 border-radius: 50%;
 top: -100px;
 right: -100px;
 }
 
 .header-content {
 position: relative;
 z-index: 1;
 }
 
 .header-icon {
 width: 80px;
 height: 80px;
 background: rgba(255, 255, 255, 0.2);
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 2.5rem;
 margin-bottom: 20px;
 backdrop-filter: blur(10px);
 color: white;
 }

 .header h1 {
 color: white;
 margin-bottom: 12px;
 font-size: 2.2rem;
 font-weight: 700;
 }

 .header p {
 color: rgba(255, 255, 255, 0.95);
 font-size: 1.05rem;
 line-height: 1.6;
 }

 .session-card {
 background: white;
 border-radius: 20px;
 padding: 32px;
 margin-bottom: 24px;
 box-shadow: 0 8px 24px rgba(0,0,0,0.08);
 transition: all 0.3s ease;
 position: relative;
 overflow: hidden;
 border-left: 5px solid var(--sage-green);
 }
 
 .session-card:hover {
 transform: translateY(-4px);
 box-shadow: 0 12px 32px rgba(0,0,0,0.12);
 }
 
 .session-card.recommended {
 border-left-color: var(--rose);
 background: linear-gradient(135deg, #fff 0%, #fffbf5 100%);
 }
 
 .session-card.enrolled {
 border-left-color: var(--peach);
 background: linear-gradient(135deg, #fff 0%, #f5fff8 100%);
 }

 .session-header {
 display: flex;
 justify-content: space-between;
 align-items: flex-start;
 margin-bottom: 20px;
 flex-wrap: wrap;
 gap: 16px;
 }

 .session-title {
 flex: 1;
 min-width: 250px;
 }

 .session-title h2 {
 color: var(--mauve);
 font-size: 1.5rem;
 margin-bottom: 8px;
 }

 .session-type {
 display: inline-flex;
 align-items: center;
 gap: 6px;
 padding: 6px 14px;
 border-radius: 20px;
 font-size: 0.85rem;
 font-weight: 600;
 }

 .type-technical {
 background: rgba(143, 185, 168, 0.15);
 color: var(--sage-green);
 }

 .type-interview {
 background: rgba(241, 130, 141, 0.15);
 color: var(--rose);
 }

 .type-communication {
 background: rgba(252, 185, 170, 0.15);
 color: var(--peach);
 }

 .session-badges {
 display: flex;
 gap: 10px;
 flex-wrap: wrap;
 }

 .badge {
 display: inline-flex;
 align-items: center;
 gap: 6px;
 padding: 8px 16px;
 border-radius: 20px;
 font-size: 0.85rem;
 font-weight: 600;
 }

 .badge-recommended {
 background: linear-gradient(135deg, var(--rose), #e06b76);
 color: white;
 box-shadow: 0 4px 12px rgba(241, 130, 141, 0.3);
 }

 .badge-enrolled {
 background: linear-gradient(135deg, var(--sage-green), #6a9d88);
 color: white;
 box-shadow: 0 4px 12px rgba(143, 185, 168, 0.3);
 }

 .badge-full {
 background: #f44336;
 color: white;
 }

 .session-details {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
 gap: 20px;
 margin-bottom: 20px;
 }

 .detail-item {
 display: flex;
 align-items: center;
 gap: 12px;
 color: #555;
 }

 .detail-item i {
 width: 40px;
 height: 40px;
 display: flex;
 align-items: center;
 justify-content: center;
 border-radius: 12px;
 background: linear-gradient(135deg, var(--sage-green), #6a9d88);
 color: white;
 font-size: 1.1rem;
 }

 .detail-content {
 flex: 1;
 }

 .detail-label {
 font-size: 0.75rem;
 color: #999;
 text-transform: uppercase;
 letter-spacing: 0.5px;
 margin-bottom: 2px;
 }

 .detail-value {
 font-weight: 600;
 color: #333;
 }

 .session-description {
 color: #666;
 line-height: 1.7;
 margin-bottom: 20px;
 padding: 20px;
 background: rgba(143, 185, 168, 0.05);
 border-radius: 12px;
 border-left: 3px solid var(--sage-green);
 }

 .recommendation-box {
 background: linear-gradient(135deg, var(--rose), #e06b76);
 color: white;
 padding: 16px 20px;
 border-radius: 12px;
 margin-bottom: 20px;
 display: flex;
 align-items: center;
 gap: 12px;
 }

 .recommendation-box i {
 font-size: 1.5rem;
 }

 .recommendation-content {
 flex: 1;
 }

 .recommendation-title {
 font-weight: 700;
 margin-bottom: 4px;
 }

 .recommendation-reason {
 font-size: 0.9rem;
 opacity: 0.95;
 }

 .resource-links {
 display: flex;
 flex-wrap: wrap;
 gap: 10px;
 margin-bottom: 20px;
 }

 .resource-link {
 display: inline-flex;
 align-items: center;
 gap: 6px;
 padding: 8px 16px;
 background: rgba(143, 185, 168, 0.1);
 color: var(--sage-green);
 text-decoration: none;
 border-radius: 8px;
 font-size: 0.85rem;
 font-weight: 600;
 transition: all 0.3s ease;
 }

 .resource-link:hover {
 background: var(--sage-green);
 color: white;
 transform: translateY(-2px);
 }

 .session-footer {
 display: flex;
 justify-content: space-between;
 align-items: center;
 padding-top: 20px;
 border-top: 1px solid rgba(0,0,0,0.08);
 flex-wrap: wrap;
 gap: 16px;
 }

 .capacity-info {
 display: flex;
 align-items: center;
 gap: 12px;
 }

 .progress-bar {
 width: 200px;
 height: 8px;
 background: rgba(0,0,0,0.1);
 border-radius: 10px;
 overflow: hidden;
 }

 .progress-fill {
 height: 100%;
 background: linear-gradient(90deg, var(--sage-green), #6a9d88);
 transition: width 0.3s ease;
 }

 .capacity-text {
 font-size: 0.9rem;
 color: #666;
 font-weight: 600;
 }

 .btn {
 display: inline-flex;
 align-items: center;
 gap: 10px;
 padding: 14px 28px;
 background: linear-gradient(135deg, var(--sage-green), #6a9d88);
 color: white;
 text-decoration: none;
 border: none;
 border-radius: 12px;
 font-weight: 600;
 font-size: 0.95rem;
 cursor: pointer;
 transition: all 0.3s ease;
 box-shadow: 0 4px 12px rgba(143, 185, 168, 0.3);
 }

 .btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 6px 20px rgba(143, 185, 168, 0.5);
 }

 .btn:disabled {
 opacity: 0.5;
 cursor: not-allowed;
 transform: none;
 }

 .btn-unenroll {
 background: linear-gradient(135deg, #e74c3c, #c0392b);
 box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
 }

 .btn-unenroll:hover {
 box-shadow: 0 6px 20px rgba(231, 76, 60, 0.5);
 }

 .empty-state {
 text-align: center;
 padding: 60px 20px;
 }

 .empty-state i {
 font-size: 4rem;
 color: var(--sage-green);
 opacity: 0.3;
 margin-bottom: 20px;
 }

 .empty-state h3 {
 color: var(--mauve);
 margin-bottom: 10px;
 }

 .empty-state p {
 color: #666;
 }

 @media (max-width: 768px) {
 .header {
 padding: 30px 24px;
 }
 
 .header h1 {
 font-size: 1.8rem;
 }
 
 .session-card {
 padding: 24px;
 }
 
 .session-header {
 flex-direction: column;
 }
 
 .session-details {
 grid-template-columns: 1fr;
 }
 
 .session-footer {
 flex-direction: column;
 align-items: flex-start;
 }
 
 .progress-bar {
 width: 100%;
 }
 }
 </style>
</head>
<body>
 <div class="container">
 <a href="{% url 'student_portal' %}" class="back-link">
 <i class="fas fa-arrow-left"></i>
 Back to Student Portal
 </a>
 
 <div class="header">
 <div class="header-content">
 <div class="header-icon">
 <i class="fas fa-chalkboard-teacher"></i>
 </div>
 <h1>Training Sessions</h1>
 <p>Enroll in placement preparation sessions recommended by your placement cell</p>
 </div>
 </div>

 {% if sessions %}
 {% for item in sessions %}
 <div class="session-card {% if item.is_recommended %}recommended{% endif %} {% if item.is_enrolled %}enrolled{% endif %}">
 <div class="session-header">
 <div class="session-title">
 <h2>{{ item.session.title }}</h2>
 <span class="session-type type-{{ item.session.session_type }}">
 <i class="fas fa-tag"></i>
 {{ item.session.get_session_type_display }}
 </span>
 </div>
 <div class="session-badges">
 {% if item.is_recommended %}
 <span class="badge badge-recommended">
 <i class="fas fa-star"></i>
 Recommended for You
 </span>
 {% endif %}
 {% if item.is_enrolled %}
 <span class="badge badge-enrolled">
 <i class="fas fa-check-circle"></i>
 Enrolled
 </span>
 {% endif %}
 {% if item.is_full and not item.is_enrolled %}
 <span class="badge badge-full">
 <i class="fas fa-exclamation-circle"></i>
 Full
 </span>
 {% endif %}
 </div>
 </div>

 {% if item.is_recommended and item.recommendation %}
 <div class="recommendation-box">
 <i class="fas fa-lightbulb"></i>
 <div class="recommendation-content">
 <div class="recommendation-title">Why recommended?</div>
 <div class="recommendation-reason">{{ item.recommendation.reason }}</div>
 </div>
 </div>
 {% endif %}

 <div class="session-details">
 <div class="detail-item">
 <i class="fas fa-calendar"></i>
 <div class="detail-content">
 <div class="detail-label">Date</div>
 <div class="detail-value">{{ item.session.scheduled_date|date:"M d, Y" }}</div>
 </div>
 </div>
 <div class="detail-item">
 <i class="fas fa-clock"></i>
 <div class="detail-content">
 <div class="detail-label">Time</div>
 <div class="detail-value">{{ item.session.scheduled_time|time:"g:i A" }} ({{ item.session.duration_minutes }} mins)</div>
 </div>
 </div>
 <div class="detail-item">
 <i class="fas fa-map-marker-alt"></i>
 <div class="detail-content">
 <div class="detail-label">Venue</div>
 <div class="detail-value">{{ item.session.venue }}</div>
 </div>
 </div>
 </div>

 <div class="session-description">
 <i class="fas fa-info-circle" style="margin-right: 8px; color: var(--sage-green);"></i>
 {{ item.session.description }}
 </div>

 {% if item.resource_list %}
 <div class="resource-links">
 <strong style="width: 100%; margin-bottom: 4px; color: var(--mauve); font-size: 0.9rem;">
 <i class="fas fa-link"></i> Resources:
 </strong>
 {% for link in item.resource_list %}
 <a href="{{ link }}" target="_blank" class="resource-link">
 <i class="fas fa-external-link-alt"></i>
 Resource {{ forloop.counter }}
 </a>
 {% endfor %}
 </div>
 {% endif %}

 <div class="session-footer">
 <div class="capacity-info">
 <div class="progress-bar">
 <div class="progress-fill" style="width: {% widthratio item.enrolled_count item.session.max_students 100 %}%"></div>
 </div>
 <span class="capacity-text">
 {{ item.enrolled_count }}/{{ item.session.max_students }} enrolled
 {% if item.seats_left > 0 %}
 ({{ item.seats_left }} seats left)
 {% endif %}
 </span>
 </div>

 {% if item.is_enrolled %}
 <button class="btn btn-unenroll" onclick="unenrollSession({{ item.session.id }}, '{{ item.session.title|escapejs }}')">
 <i class="fas fa-times-circle"></i>
 <span>Unenroll</span>
 </button>
 {% elif item.is_full %}
 <button class="btn" disabled>
 <i class="fas fa-lock"></i>
 <span>Session Full</span>
 </button>
 {% else %}
 <button class="btn" onclick="enrollSession({{ item.session.id }}, '{{ item.session.title|escapejs }}')">
 <i class="fas fa-plus-circle"></i>
 <span>Enroll Now</span>
 </button>
 {% endif %}
 </div>
 </div>
 {% endfor %}
 {% else %}
 <div class="empty-state">
 <i class="fas fa-calendar-times"></i>
 <h3>No Sessions Available</h3>
 <p>There are no upcoming training sessions at the moment. Check back later!</p>
 </div>
 {% endif %}
 </div>

 <script>
 function getCookie(name) {
 let cookieValue = null;
 if (document.cookie && document.cookie !== '') {
 const cookies = document.cookie.split(';');
 for (let i = 0; i < cookies.length; i++) {
 const cookie = cookies[i].trim();
 if (cookie.substring(0, name.length + 1) === (name + '=')) {
 cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
 break;
 }
 }
 }
 return cookieValue;
 }

 function enrollSession(sessionId, sessionTitle) {
 if (!confirm(`Enroll in "${sessionTitle}"?`)) {
 return;
 }

 fetch(`/student/session/${sessionId}/enroll/`, {
 method: 'POST',
 headers: {
 'X-CSRFToken': getCookie('csrftoken'),
 'Content-Type': 'application/json'
 }
 })
 .then(response => response.json())
 .then(data => {
 if (data.success) {
 alert(data.message);
 location.reload();
 } else {
 alert('Error: ' + data.message);
 }
 })
 .catch(error => {
 alert('An error occurred. Please try again.');
 console.error('Error:', error);
 });
 }

 function unenrollSession(sessionId, sessionTitle) {
 if (!confirm(`Unenroll from "${sessionTitle}"? This action cannot be undone.`)) {
 return;
 }

 fetch(`/student/session/${sessionId}/unenroll/`, {
 method: 'POST',
 headers: {
 'X-CSRFToken': getCookie('csrftoken'),
 'Content-Type': 'application/json'
 }
 })
 .then(response => response.json())
 .then(data => {
 if (data.success) {
 alert(data.message);
 location.reload();
 } else {
 alert('Error: ' + data.message);
 }
 })
 .catch(error => {
 alert('An error occurred. Please try again.');
 console.error('Error:', error);
 });
 }
 </script>
</body>
</html>
